<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                template="./../template/htmlTemplate.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html">

    <ui:define name="meta">
        <title>#{bundle.edit_pagetitle}</title>
        <f:metadata>
            <f:viewParam name="key" value="#{editSurveyManagedBean.em.key}" />
        </f:metadata>
    </ui:define>

    <ui:define name="top">
        edit

    </ui:define>

    <ui:define name="left">


    </ui:define>

    <ui:define name="content">

        <ice:outputText value="The given key is wrong!"  rendered="#{editSurveyManagedBean.em.survey == null}" />

        <ice:panelGroup styleClass="ice-skin-rime" rendered="#{editSurveyManagedBean.em.survey != null}">
            <ice:form>
                <ice:panelCollapsible expanded="true">
                    <f:facet name="header">
                        <ice:panelGroup>
                            <ice:outputText value="#{bundle.survey_profile}"/>
                        </ice:panelGroup>
                    </f:facet>
                    <ice:panelGroup>
                        <ice:panelGrid columns="2" styleClass="ice-skin-rime">
                            <ice:outputText value="#{bundle.survey_title}: "/>
                            <ice:inputText value="#{editSurveyManagedBean.em.survey.name}"/>
                            <ice:outputText value="#{bundle.survey_start}: "/>

                            <ice:selectInputDate id="calendar1"
                                                 popupDateFormat="MM/dd/yyyy"
                                                 value="#{editSurveyManagedBean.em.survey.startDate}" renderAsPopup="true" />
                            <ice:outputText value="#{bundle.survey_end}: "/>

                            <ice:selectInputDate id="calendar2"
                                                 popupDateFormat="MM/dd/yyyy"
                                                 value="#{editSurveyManagedBean.em.survey.endDate}" renderAsPopup="true" />          
                            <ice:outputText value="#{bundle.randomQuestion}: "/>
                            <ice:selectBooleanCheckbox  id="randomQuestions" value="#{editSurveyManagedBean.em.survey.randomQuestionOrder}" />
                            <ice:commandButton id="resetProfile" value="#{bundle.reset}"
                                               action="#{editSurveyManagedBean.reset()}" />
                            <ice:commandButton id="saveProfile" value="#{bundle.save_head}"
                                               action="#{editSurveyManagedBean.save()}" />
                        </ice:panelGrid>
                    </ice:panelGroup>
                </ice:panelCollapsible>
            </ice:form>
            <ice:form>
                <ice:panelPositioned var="question"
                                     value="#{editSurveyManagedBean.em.survey.questionList}"
                                     style="margin-left: 10px"
                                     listener="#{editSurveyManagedBean.changedQuestionOrder(evt)}">
                    <ice:panelGroup>
                        <ice:panelCollapsible expanded="#{editSurveyManagedBean.em.getCollapseList(question.idQuestion).collapse}" rendered="#{question.questionType == 'norm'}">
                            <f:facet name="header">
                                <ice:panelGroup>
                                    <ice:outputText value="#{question.orderNumber}: #{question.label} "/>
                                </ice:panelGroup>
                            </f:facet>
                            <ice:panelGroup>
                                <ice:panelGrid columns="2" styleClass="ice-skin-rime">
                                    <ice:outputText value="#{bundle.question}"/>
                                    <ice:inputText value="#{question.label}"/>

                                    <ice:outputText value="#{bundle.answerLimit}"/>
                                    <ice:inputText value="#{question.answerLimit}"/>

                                    <ice:outputText value="#{bundle.randomAnswer}"/>
                                    <ice:selectBooleanCheckbox value="#{question.randomAnswerOrder}" />    
                                    <ice:commandButton value="#{bundle.removeQuestion}" action="#{editSurveyManagedBean.removeQuestion(question)}" />
                                </ice:panelGrid>

                                <!-- answer list -->
                                <ice:panelSeries var="answer"
                                                 value="#{question.answerList}"
                                                 style="margin-left: 20px" >

                                    <ice:panelGrid columns="3" >
                                        <ice:outputText value="#{answer.orderNumber} - #{bundle.answer}"/>
                                        <ice:inputText value="#{answer.label}"/>      
                                        <ice:commandButton value="#{bundle.removeAnswer}" action="#{editSurveyManagedBean.removeAnswer(question,answer)}" />
                                    </ice:panelGrid>                               
                                </ice:panelSeries>
                                <ice:commandButton value="#{bundle.addAnswer}" action="#{editSurveyManagedBean.addAnswer(question)}" />
                            </ice:panelGroup>
                        </ice:panelCollapsible>
                        <ice:panelCollapsible expanded="#{editSurveyManagedBean.em.getCollapseList(question.idQuestion).collapse}" rendered="#{question.questionType == 'acc'}">
                            <f:facet name="header">
                                <ice:panelGroup>
                                    <ice:outputText value="#{question.orderNumber}: #{question.label} "/>
                                </ice:panelGroup>
                            </f:facet>
                            <ice:panelGroup>
                                <ice:panelGrid columns="2" styleClass="ice-skin-rime">
                                    <ice:outputText value="#{bundle.question}"/>
                                    <ice:inputText value="#{question.label}"/>
    
                                    <ice:commandButton value="#{bundle.removeQuestion}" action="#{editSurveyManagedBean.removeQuestion(question)}" />
                                </ice:panelGrid>

                                <!-- answer list -->

                                <ice:panelGrid columns="2" style="background-color: lightgreen">
                                        <ice:outputText value="#{question.answerList.get(0).orderNumber} - #{bundle.answer}"/>
                                        <ice:inputText value="#{question.answerList.get(0).label}"/>      
                                    </ice:panelGrid>           
                                                                        <ice:panelGrid columns="2"  style="background-color: lightcoral">
                                        <ice:outputText value="#{question.answerList.get(1).orderNumber} - #{bundle.answer}"/>
                                        <ice:inputText value="#{question.answerList.get(1).label}"/>      
                                    </ice:panelGrid>  
                            </ice:panelGroup>
                        </ice:panelCollapsible>
                    </ice:panelGroup>
                </ice:panelPositioned>
                <ice:panelGrid columns="3" styleClass="ice-skin-rime">
                    <ice:outputText value="#{bundle.questionType}" />
                    <ice:selectOneMenu value="#{editSurveyManagedBean.em.questionType}"> 
                        <f:selectItem itemLabel="#{bundle.addNormQuestion}" itemValue="norm" />
                        <f:selectItem itemLabel="#{bundle.addAccQuestion}" itemValue="acc" />
                    </ice:selectOneMenu>
                    <ice:commandButton value="#{bundle.addQuestion}" action="#{editSurveyManagedBean.addQuestion()}" />
                    <ice:commandButton value="#{bundle.save_poll}" action="#{editSurveyManagedBean.save()}" />
                </ice:panelGrid>
            </ice:form>
        </ice:panelGroup>
        <h:outputStylesheet library="css" name="tableLayout.css" />
    </ui:define>

</ui:composition>
